<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Claude 3.7 Sonnet Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background-color: #f9f9f9;
    }
    h1 {
      color: #5046e4;
      border-bottom: 2px solid #eee;
      padding-bottom: 10px;
    }
    .chat-window {
      border: 1px solid #ddd;
      border-radius: 8px;
      height: 400px;
      overflow-y: auto;
      padding: 15px;
      background-color: white;
      margin-bottom: 20px;
    }
    .input-area {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }
    textarea {
      flex: 1;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      min-height: 80px;
      resize: vertical;
    }
    button {
      background-color: #5046e4;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 0 20px;
      cursor: pointer;
      font-weight: bold;
    }
    button:hover {
      background-color: #3c34b7;
    }
    button:disabled {
      background-color: #ccc;
      cursor: not-allowed;
    }
    .message {
      margin-bottom: 15px;
      padding: 12px;
      border-radius: 8px;
      max-width: 80%;
    }
    .user-message {
      background-color: #e6f7ff;
      align-self: flex-end;
      margin-left: auto;
    }
    .assistant-message {
      background-color: #f0ebff;
      border-left: 3px solid #5046e4;
    }
    .message-container {
      display: flex;
      flex-direction: column;
    }
    .message-role {
      font-size: 12px;
      font-weight: bold;
      margin-bottom: 5px;
      color: #555;
    }
    .settings {
      background-color: #f0f0f0;
      padding: 15px;
      border-radius: 8px;
      margin-bottom: 20px;
    }
    .settings h3 {
      margin-top: 0;
    }
    select, input {
      padding: 8px;
      border-radius: 4px;
      border: 1px solid #ddd;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    .model-badge {
      display: inline-block;
      background-color: #5046e4;
      color: white;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 11px;
      margin-left: 5px;
    }
    .loading {
      display: inline-block;
      margin-left: 10px;
      color: #5046e4;
    }
    .token-info {
      font-size: 11px;
      color: #888;
      text-align: right;
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>Claude 3.7 Sonnet Test UI</h1>
  
  <div class="settings">
    <h3>Settings</h3>
    <div>
      <label for="provider">Provider:</label>
      <select id="provider">
        <option value="anthropic" selected>Anthropic Claude</option>
        <option value="openai">OpenAI</option>
      </select>
      
      <label for="model">Model:</label>
      <select id="model">
        <option value="claude-3-7-sonnet-20250218" selected>Claude 3.7 Sonnet</option>
        <option value="claude-3-opus-20240229">Claude 3 Opus</option>
        <option value="claude-3-sonnet-20240229">Claude 3 Sonnet</option>
      </select>
    </div>
    <div>
      <label for="api-key">API Key:</label>
      <input type="password" id="api-key" placeholder="Enter your Anthropic API key">
      <button id="save-key">Save API Key</button>
    </div>
  </div>
  
  <div class="chat-window" id="chat-window">
    <!-- Messages will appear here -->
  </div>
  
  <div class="input-area">
    <textarea id="prompt" placeholder="Type your message here..."></textarea>
    <button id="send">Send</button>
    <span id="loading" class="loading" style="display: none;">Generating...</span>
  </div>
  
  <script>
    // Elements
    const chatWindow = document.getElementById('chat-window');
    const promptInput = document.getElementById('prompt');
    const sendButton = document.getElementById('send');
    const loadingIndicator = document.getElementById('loading');
    const providerSelect = document.getElementById('provider');
    const modelSelect = document.getElementById('model');
    const apiKeyInput = document.getElementById('api-key');
    const saveKeyButton = document.getElementById('save-key');
    
    // Mock conversation state
    let messages = [];
    let isGenerating = false;
    
    // Save API key
    saveKeyButton.addEventListener('click', () => {
      const apiKey = apiKeyInput.value.trim();
      if (apiKey) {
        localStorage.setItem(`apiKey_${providerSelect.value}`, apiKey);
        alert('API key saved!');
      } else {
        alert('Please enter an API key');
      }
    });
    
    // Check for saved API key on load
    window.addEventListener('load', () => {
      const savedKey = localStorage.getItem(`apiKey_${providerSelect.value}`);
      if (savedKey) {
        apiKeyInput.value = savedKey;
      }
      
      // Add welcome message
      addMessage({
        role: 'assistant',
        content: `ðŸ‘‹ Welcome to the Claude 3.7 Sonnet test interface. This is a simple UI for testing Claude 3.7 Sonnet integration.

This interface does not actually connect to any server or API - it's purely a UI demonstration to show the integration work that's been done. In a real implementation, this would connect to your server's API endpoints.`,
        metadata: {
          modelId: 'claude-3-7-sonnet-20250218',
          provider: 'anthropic'
        }
      });
    });
    
    // Provider change handler
    providerSelect.addEventListener('change', () => {
      // Update model options based on selected provider
      modelSelect.innerHTML = '';
      
      if (providerSelect.value === 'anthropic') {
        addOption(modelSelect, 'claude-3-7-sonnet-20250218', 'Claude 3.7 Sonnet');
        addOption(modelSelect, 'claude-3-opus-20240229', 'Claude 3 Opus');
        addOption(modelSelect, 'claude-3-sonnet-20240229', 'Claude 3 Sonnet');
      } else {
        addOption(modelSelect, 'gpt-4', 'GPT-4');
        addOption(modelSelect, 'gpt-3.5-turbo', 'GPT-3.5 Turbo');
      }
      
      // Check for saved API key
      const savedKey = localStorage.getItem(`apiKey_${providerSelect.value}`);
      if (savedKey) {
        apiKeyInput.value = savedKey;
      } else {
        apiKeyInput.value = '';
      }
    });
    
    // Helper to add option to select
    function addOption(select, value, text) {
      const option = document.createElement('option');
      option.value = value;
      option.textContent = text;
      select.appendChild(option);
    }
    
    // Send message handler
    sendButton.addEventListener('click', sendMessage);
    promptInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter' && !e.shiftKey) {
        e.preventDefault();
        sendMessage();
      }
    });
    
    function sendMessage() {
      const prompt = promptInput.value.trim();
      if (!prompt || isGenerating) return;
      
      // Add user message
      const userMessage = {
        role: 'user',
        content: prompt,
        timestamp: Date.now()
      };
      addMessage(userMessage);
      messages.push(userMessage);
      
      // Clear input
      promptInput.value = '';
      
      // Generate response
      generateResponse(prompt);
    }
    
    function addMessage(message) {
      const messageElement = document.createElement('div');
      messageElement.className = `message ${message.role === 'user' ? 'user-message' : 'assistant-message'}`;
      
      const containerElement = document.createElement('div');
      containerElement.className = 'message-container';
      
      const roleElement = document.createElement('div');
      roleElement.className = 'message-role';
      roleElement.textContent = message.role === 'user' ? 'You' : 'Claude';
      
      // Add model badge for assistant messages
      if (message.role === 'assistant' && message.metadata?.modelId) {
        const modelBadge = document.createElement('span');
        modelBadge.className = 'model-badge';
        modelBadge.textContent = message.metadata.modelId.includes('claude-3-7') ? 'Claude 3.7 Sonnet' : 
                                 message.metadata.modelId;
        roleElement.appendChild(modelBadge);
      }
      
      const contentElement = document.createElement('div');
      contentElement.className = 'message-content';
      contentElement.textContent = message.content;
      
      // Add token info for assistant messages
      if (message.role === 'assistant' && message.metadata?.usage) {
        const tokenInfo = document.createElement('div');
        tokenInfo.className = 'token-info';
        tokenInfo.textContent = `${message.metadata.usage.totalTokens || 0} tokens`;
        containerElement.appendChild(tokenInfo);
      }
      
      containerElement.appendChild(roleElement);
      containerElement.appendChild(contentElement);
      messageElement.appendChild(containerElement);
      
      chatWindow.appendChild(messageElement);
      chatWindow.scrollTop = chatWindow.scrollHeight;
    }
    
    async function generateResponse(prompt) {
      // Show loading indicator
      isGenerating = true;
      loadingIndicator.style.display = 'inline-block';
      sendButton.disabled = true;
      
      // Get selected provider and model
      const provider = providerSelect.value;
      const modelId = modelSelect.value;
      
      // Create placeholder for assistant message
      const placeholderMessage = {
        role: 'assistant',
        content: 'Thinking...',
        metadata: {
          modelId,
          provider
        }
      };
      addMessage(placeholderMessage);
      messages.push(placeholderMessage);
      
      // Simulate API delay
      await new Promise(resolve => setTimeout(resolve, 1500));
      
      // Generate mock response
      let response = '';
      
      if (prompt.toLowerCase().includes('hello') || prompt.toLowerCase().includes('hi ')) {
        response = `Hello! I'm Claude 3.7 Sonnet, and I'm here to help answer your questions or assist with tasks. How can I help you today?`;
      } else if (prompt.toLowerCase().includes('capabilities') || prompt.toLowerCase().includes('what can you do')) {
        response = `As Claude 3.7 Sonnet, I can:

1. Provide detailed answers to your questions
2. Help with writing and editing content
3. Analyze and explain complex topics
4. Assist with creative tasks like brainstorming
5. Process and summarize information

I have a 200K token context window, which means I can work with very long conversations and documents. I'm designed to be helpful, harmless, and honest in my interactions.`;
      } else if (prompt.toLowerCase().includes('model') || prompt.toLowerCase().includes('claude 3.7')) {
        response = `Claude 3.7 Sonnet is Anthropic's latest large language model, released in May 2025. It features improved reasoning capabilities, a 200K token context window, and better instruction following compared to previous Claude models.

Some key improvements in Claude 3.7 Sonnet include:
- Enhanced reasoning and problem-solving abilities
- Better coding capabilities with improved accuracy
- More nuanced understanding of context and instructions
- Improved conversation abilities that feel more natural`;
      } else {
        response = `Thank you for your message: "${prompt}"

This is a simulated response from Claude 3.7 Sonnet in the test UI. In a real implementation, this would be an actual response from the Anthropic API.

The integration work includes:
1. Client-side components for displaying Claude 3.7 responses
2. Special styling for Claude messages with purple accents
3. Token usage tracking and display
4. Support for both streaming and non-streaming responses`;
      }
      
      // Update placeholder message
      const messageIndex = messages.length - 1;
      messages[messageIndex].content = response;
      messages[messageIndex].metadata.usage = {
        promptTokens: Math.ceil(prompt.length / 4),
        completionTokens: Math.ceil(response.length / 4),
        totalTokens: Math.ceil(prompt.length / 4) + Math.ceil(response.length / 4)
      };
      
      // Update in UI
      chatWindow.removeChild(chatWindow.lastChild);
      addMessage(messages[messageIndex]);
      
      // Hide loading indicator
      isGenerating = false;
      loadingIndicator.style.display = 'none';
      sendButton.disabled = false;
    }
  </script>
</body>
</html>